/*!
 * MiniBar 0.0.7
 * http://mobius.ovh/
 *
 * Released under the MIT license
 */
!function(t){"use strict";function e(t,e,i){var s;return function(){var o=this,n=arguments,r=function(){s=null,i||t.apply(o,n)},c=i&&!s;clearTimeout(s),s=setTimeout(r,e),c&&t.apply(o,n)}}var i={minBarSize:50,alwaysShowBars:!1,containerClass:"mb-container",contentClass:"mb-content",trackClass:"mb-track",barClass:"mb-bar",visibleClass:"mb-visible"},s=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var o=arguments[s];if(null!=o)for(var n in o)Object.prototype.hasOwnProperty.call(o,n)&&(i[n]=o[n])}return i},o=function(t,e,i){if("[object Object]"===Object.prototype.toString.call(t))for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.call(i,s,t[s]);else for(var o=0,n=t.length;o<n;o++)e.call(i,o,t[o])},n=function(t,e,i){t.addEventListener(e,i,!1)},r=function(t,e,i){t.removeEventListener(e,i)},c=function(t,e,i){var s=t&&t.style,n="[object Object]"===Object.prototype.toString.call(e);if(s){if(void 0===i&&!n)return i=window.getComputedStyle(t),void 0===e?i:i[e];n?o(e,function(t,e){t in s||(t="-webkit-"+t),s[t]=e+("string"==typeof e?"":"opacity"===t?"":"px")}):(e in s||(e="-webkit-"+e),s[e]=i+("string"==typeof i?"":"opacity"===e?"":"px"))}},a=function(t){var e=window,i=document,s=i.body,o=t.getBoundingClientRect(),n=void 0!==e.pageXOffset?e.pageXOffset:(i.documentElement||s.parentNode||s).scrollLeft,r=void 0!==e.pageYOffset?e.pageYOffset:(i.documentElement||s.parentNode||s).scrollTop;return{x:o.left+n,y:o.top+r,height:Math.round(o.height),width:Math.round(o.width)}},l=window.requestAnimationFrame||function(){var t=0;return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){var i,s=(new Date).getTime();return i=Math.max(0,16-(s-t)),t=s+i,setTimeout(function(){e(s+i)},i)}}(),h=function(){var t=0,e=document.createElement("div");return e.style.cssText="width: 100; height: 100; overflow: scroll; position: absolute; top: -9999;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth,document.body.removeChild(e),t},d=function(t,o){this.container=t,"string"==typeof content&&(this.container=document.querySelector(t)),this.config=s({},i,o),this.css=window.getComputedStyle(this.container),this.scrollbarSize=h(),this.trackPos={x:"left",y:"top"},this.trackSize={x:"width",y:"height"},this.scrollPos={x:"scrollLeft",y:"scrollTop"},this.scrollSize={x:"scrollWidth",y:"scrollHeight"},this.events={update:this.update.bind(this),scroll:this.scroll.bind(this),mouseenter:this.mouseenter.bind(this),mousedown:this.mousedown.bind(this),mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)},this.events.debounce=e(this.events.update,50),this.init()};d.prototype.init=function(){var t=this;for(this.container.classList.add(this.config.containerClass),this.content=document.createElement("div"),this.content.classList.add(this.config.contentClass),this.config.alwaysShowBars&&this.container.classList.add(this.config.visibleClass);this.container.firstChild;)t.content.appendChild(this.container.firstChild);this.bars={x:{},y:{}},this.tracks={x:{},y:{}},o(this.tracks,function(e,i){t.bars[e].node=document.createElement("div"),i.node=document.createElement("div"),i.node.classList.add(t.config.trackClass,t.config.trackClass+"-"+e),t.bars[e].node.classList.add(t.config.barClass),i.node.appendChild(t.bars[e].node),t.container.appendChild(i.node),n(t.bars[e].node,"mousedown",t.events.mousedown)}),this.container.appendChild(this.content),this.container.style.position="static"===this.css.position?"relative":this.css.position,n(this.content,"scroll",this.events.scroll),n(this.container,"mouseenter",this.events.mouseenter),n(window,"resize",this.events.debounce),n(document,"DOMContentLoaded",this.events.update),n(window,"load",this.events.update)},d.prototype.scroll=function(){this.updateScrollBar("x"),this.updateScrollBar("y")},d.prototype.mouseenter=function(){this.updateScrollBar("x"),this.updateScrollBar("y")},d.prototype.mousedown=function(t){t.preventDefault();var e=t.target===this.bars.x.node?"x":"y",i=this.bars[e],s=this.tracks[e];this.currentAxis=e,this.update(),this.container.classList.add(this.config.visibleClass),this.origin={x:t.pageX-i.x,y:t.pageY-i.y,axis:"page"+e.toUpperCase(),prop:"x"===e?s.width:s.height,size:"x"===e?"scrollWidth":"scrollHeight",offset:"x"===e?"scrollLeft":"scrollTop"},n(document,"mousemove",this.events.mousemove),n(document,"mouseup",this.events.mouseup)},d.prototype.mousemove=function(t){t.preventDefault();var e=this.origin,i=this.currentAxis,s=t[e.axis],o=this.tracks[i],n=this.content,r=(s-e[i]-o[i])/e.prop*this[e.size];l(function(){n[e.offset]=r})},d.prototype.mouseup=function(){this.origin={},this.currentAxis=null,this.container.classList.toggle(this.config.visibleClass,this.config.alwaysShowBars),r(document,"mousemove",this.events.mousemove),r(document,"mouseup",this.events.mouseup)},d.prototype.update=function(){var t=this;o(this.tracks,function(e,i){s(i,a(i.node)),s(t.bars[e],a(t.bars[e].node))}),this.rect=a(this.container),this.scrollTop=this.content.scrollTop,this.scrollLeft=this.content.scrollLeft,this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth;var e=this.scrollWidth>this.rect.width,i=this.scrollHeight>this.rect.height;this.container.classList.toggle("mb-scroll-x",e),this.container.classList.toggle("mb-scroll-y",i),c(this.content,{overflow:"auto",marginBottom:e?-this.scrollbarSize:"",paddingBottom:e?this.scrollbarSize:"",marginRight:i?-this.scrollbarSize:"",paddingRight:i?this.scrollbarSize:""}),this.scrollX=e,this.scrollY=i,o(["x","y"],function(e,i){t.updateScrollBar(i)})},d.prototype.updateScrollBar=function(t){var e={},i=this.bars[t].node,s=this.tracks[t][this.trackSize[t]],o=this.content[this.scrollPos[t]],n=s/this[this.scrollSize[t]],r=o/(this[this.scrollSize[t]]-s);e[this.trackSize[t]]=Math.max(Math.floor(n*s),this.config.minBarSize),e[this.trackPos[t]]=Math.floor((s-e[this.trackSize[t]])*r),l(function(){c(i,e)})},d.prototype.destroy=function(){var t=this;o(this.tracks,function(e,i){r(t.bars[e].node,"mousedown",t.events.mousedown)}),r(this.content,"scroll",this.events.scroll),r(this.container,"mouseenter",this.events.mouseenter),r(window,"resize",this.events.debounce),this.content.removeAttribute("style"),this.container.parentNode.replaceChild(this.content,this.container)},t.MiniBar=d}(this);
