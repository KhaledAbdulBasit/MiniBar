/*!
 * MiniBar 0.2.1
 * http://mobius.ovh/
 *
 * Released under the MIT license
 */
!function(e){"use strict";var t=window,n=document,o=n.body,s={x:"left",y:"top"},a={x:"width",y:"height"},r={x:"scrollLeft",y:"scrollTop"},i={x:"scrollWidth",y:"scrollHeight"},c={x:"pageX",y:"pageY"},l={barType:"default",minBarSize:10,alwaysShowBars:!1,horizontalMouseScroll:!1,scrollX:!0,scrollY:!0,navButtons:!1,scrollAmount:10,containerClass:"mb-container",contentClass:"mb-content",trackClass:"mb-track",barClass:"mb-bar",visibleClass:"mb-visible",progressClass:"mb-progress",hoverClass:"mb-hover",scrollingClass:"mb-scrolling",textareaClass:"mb-textarea",wrapperClass:"mb-wrapper",navClass:"mb-nav",btnClass:"mb-button",btnsClass:"mb-buttons",increaseClass:"mb-increase",decreaseClass:"mb-decrease"},d=function(e,t){for(var n=Object(e),o=1;o<arguments.length;o++){var s=arguments[o];if(null!=s)for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(n[a]=s[a])}return n},u=function(e,t,n){e.addEventListener(t,n,!1)},p=function(e,t,n){e.removeEventListener(t,n)},m=function(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(n,o,e[o]);else for(var s=0,a=e.length;s<a;s++)t.call(n,s,e[s])},h=function(e,n){var o=e&&e.style,s="[object Object]"===Object.prototype.toString.call(n);if(o){if(!n)return t.getComputedStyle(e);s&&m(n,function(e,t){e in o||(e="-webkit-"+e),o[e]=t+("string"==typeof t?"":"opacity"===e?"":"px")})}},f=function(e){var s=t,a=e.getBoundingClientRect(),r=n.documentElement||o.parentNode||o,i=void 0!==s.pageXOffset?s.pageXOffset:r.scrollLeft,c=void 0!==s.pageYOffset?s.pageYOffset:r.scrollTop;return{x:a.left+i,y:a.top+c,height:Math.round(a.height),width:Math.round(a.width)}},v=function(e,t,n){var o;return function(){var s=this,a=arguments,r=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||e.apply(s,a)},t),r&&e.apply(s,a)}},g=t.requestAnimationFrame||function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var n,o=(new Date).getTime();return n=Math.max(0,16-(o-e)),e=o+n,setTimeout(function(){t(o+n)},n)}}(),b=t.cancelAnimationFrame||void clearTimeout(void 0),C=function(){var e=0,t=n.createElement("div");return t.style.cssText="width: 100; height: 100; overflow: scroll; position: absolute; top: -9999;",n.body.appendChild(t),e=t.offsetWidth-t.clientWidth,n.body.removeChild(t),e},w={contains:function(e,t){if(e)return e.classList?e.classList.contains(t):!!e.className&&!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},add:function(e,t){w.contains(e,t)||(e.classList?e.classList.add(t):e.className=e.className.trim()+" "+t)},remove:function(e,t){w.contains(e,t)&&(e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," "))},toggle:function(e,t,n){var o=this.contains(e,t)?!0!==n&&"remove":!1!==n&&"add";o&&this[o](e,t)}},y=function(e,o){this.container="string"==typeof e?n.querySelector(e):e,this.config=l,o?this.config=d({},l,o):t.MiniBarOptions&&(this.config=d({},l,t.MiniBarOptions)),this.css=t.getComputedStyle(this.container),this.size=C(),this.textarea="textarea"===this.container.nodeName.toLowerCase(),this.bars={x:{},y:{}},this.tracks={x:{},y:{}},this.events={},m(["update","scroll","mouseenter","mousedown","mousemove","mouseup","wheel"],function(e,t){this.events[t]=this[t].bind(this)},this),this.events.debounce=v(this.events.update,50),this.init()},x=y.prototype;x.init=function(){var e=this,o=e.config,s=e.events;if(!e.initialised){if(e.textarea)e.content=e.container,e.container=n.createElement("div"),w.add(e.container,o.textareaClass),e.wrapper=n.createElement("div"),w.add(e.wrapper,o.wrapperClass),e.container.appendChild(e.wrapper),e.content.parentNode.insertBefore(e.container,e.content),e.content.addEventListener("input",function(t){e.update()});else for(e.content=n.createElement("div");e.container.firstChild;)e.content.appendChild(e.container.firstChild);w.add(e.container,o.containerClass),w.add(e.content,o.contentClass),o.alwaysShowBars&&w.add(e.container,o.visibleClass),m(e.tracks,function(t,a){if(e.bars[t].node=n.createElement("div"),a.node=n.createElement("div"),w.add(a.node,o.trackClass),w.add(a.node,o.trackClass+"-"+t),w.add(e.bars[t].node,o.barClass),a.node.appendChild(e.bars[t].node),o.navButtons){var i=n.createElement("button"),c=n.createElement("button"),l=n.createElement("div"),d=o.scrollAmount;i.className=o.btnClass+" "+o.decreaseClass,c.className=o.btnClass+" "+o.increaseClass,l.className=o.btnsClass+" "+o.btnsClass+"-"+t,l.appendChild(i),l.appendChild(a.node),l.appendChild(c),e.container.appendChild(l),w.add(e.container,o.navClass),u(l,"mousedown",function(n){var o=n.target;if(b(e.frame),o===c||o===i){var s=e.content[r[t]],a=function(n){switch(e.content[r[t]]=s,o){case i:s-=d;break;case c:s+=d}e.frame=g(a)};a()}}),u(l,"mouseup",function(n){var o=n.target,s=5*d;b(e.frame),o!==c&&o!==i||e.scrollBy(o===i?-s:s,t)})}else e.container.appendChild(a.node);"progress"===o.barType?(w.add(a.node,o.progressClass),u(a.node,"mousedown",s.mousedown)):u(e.bars[t].node,"mousedown",s.mousedown),u(a.node,"mouseenter",function(n){w.add(e.container,o.hoverClass+"-"+t)}),u(a.node,"mouseleave",function(n){e.down||w.remove(e.container,o.hoverClass+"-"+t)})}),e.textarea?e.wrapper.appendChild(e.content):e.container.appendChild(e.content),"static"===e.css.position&&(e.manualPosition=!0,e.container.style.position="relative"),e.update(),u(e.content,"scroll",s.scroll),u(e.container,"mouseenter",s.mouseenter),o.horizontalMouseScroll&&u(e.content,"wheel",s.wheel),u(t,"resize",s.debounce),u(n,"DOMContentLoaded",s.update),u(t,"load",s.update),e.initialised=!0}},x.scroll=function(e){this.updateBars()},x.scrollBy=function(e,t,n,o){if(t=t||"y",0!==n){void 0===n&&(n=250),o=o||function(e,t,n,o){return e/=o,-n*e*(e-2)+t};var s=this,a=Date.now(),i=s.content[r[t]],c=function(){var l=Date.now()-a;l>n?b(s.frame):(s.content[r[t]]=o(l,i,e,n),s.frame=g(c))};c()}else this.content[r[t]]+=e},x.wheel=function(e){e.preventDefault(),this.scrollBy(100*e.deltaY,"x")},x.mouseenter=function(e){this.updateBars()},x.mousedown=function(e){e.preventDefault(),this.down=!0;var t=this,o=t.config,s="progress"===o.barType?"tracks":"bars",a=e.target===t[s].x.node?"x":"y";t.currentAxis=a,t.update(),w.add(t.container,o.visibleClass),w.add(t.container,o.scrollingClass+"-"+a),"progress"===o.barType?(t.origin={x:e.pageX-t.tracks[a].x,y:e.pageY-t.tracks[a].y},t.mousemove(e)):t.origin={x:e.pageX-t.bars[a].x,y:e.pageY-t.bars[a].y},u(n,"mousemove",t.events.mousemove),u(n,"mouseup",t.events.mouseup)},x.mousemove=function(e){e.preventDefault();var t,n,o=this,s=this.origin,l=this.currentAxis,d=o.tracks[l],u=d[a[l]],p="progress"===o.config.barType;t=(p?e[c[l]]-d[l]:e[c[l]]-s[l]-d[l])/u,n=p?t*(o.content[i[l]]-o.rect[a[l]]):t*o[i[l]],g(function(){o.content[r[l]]=n})},x.mouseup=function(e){var t=this,o=t.config,s=t.events;w.toggle(t.container,o.visibleClass,o.alwaysShowBars),w.remove(t.container,o.scrollingClass+"-"+t.currentAxis),w.contains(e.target,o.barClass)||(w.remove(t.container,o.hoverClass+"-x"),w.remove(t.container,o.hoverClass+"-y")),t.currentAxis=null,t.down=!1,p(n,"mousemove",s.mousemove),p(n,"mouseup",s.mouseup)},x.update=function(){var e=this,t=e.config,n=e.content,o=e.size;e.rect=f(e.container),e.scrollTop=n.scrollTop,e.scrollLeft=n.scrollLeft,e.scrollHeight=n.scrollHeight,e.scrollWidth=n.scrollWidth;var s=e.scrollWidth>e.rect.width&&!e.textarea,a=e.scrollHeight>e.rect.height;if(w.toggle(e.container,"mb-scroll-x",s&&t.scrollX),w.toggle(e.container,"mb-scroll-y",a&&t.scrollY),h(n,{overflowX:s?"auto":"",overflowY:a?"auto":"",marginBottom:s?-o:"",paddingBottom:s?o:"",marginRight:a?-o:"",paddingRight:a?o:""}),e.scrollX=s,e.scrollY=a,m(e.tracks,function(t,n){d(n,f(n.node)),d(e.bars[t],f(e.bars[t].node))}),e.updateBars(),e.wrapperPadding=0,e.textarea){var r=h(e.wrapper);e.wrapperPadding=parseInt(r.paddingTop,10)+parseInt(r.paddingBottom,10),!e.down&&e.content.selectionStart>=e.content.value.length&&(e.content.scrollTop=e.scrollHeight+1e3)}},x.updateBar=function(e){var t=this,n={},o=a,c=i,l=t.config,d=t.tracks[e][o[e]],u=t.rect[o[e]]-t.wrapperPadding,p=t.content[r[e]],m=d/t[c[e]],f=p/(t[c[e]]-u);"progress"===l.barType?n[o[e]]=Math.floor(d*f):(n[o[e]]=Math.max(Math.floor(m*u),l.minBarSize),n[s[e]]=Math.floor((d-n[o[e]])*f)),g(function(){h(t.bars[e].node,n)})},x.updateBars=function(){m(this.bars,function(e,t){this.updateBar(e)},this)},x.destroy=function(){var e=this,n=e.config,o=e.container;if(e.initialised){for(p(o,"mouseenter",e.events.mouseenter),p(t,"resize",e.events.debounce),w.remove(o,n.visibleClass),w.remove(o,n.containerClass),w.remove(o,n.navClass),m(e.tracks,function(e,t){o.removeChild(n.navButtons?t.node.parentNode:t.node),w.remove(o,"mb-scroll-"+e)});e.content.firstChild;)o.appendChild(e.content.firstChild);o.removeChild(e.content),e.manualPosition&&(o.style.position=""),e.bars={x:{},y:{}},e.tracks={x:{},y:{}},e.content=null,e.initialised=!1}},e.MiniBar=y}(this);