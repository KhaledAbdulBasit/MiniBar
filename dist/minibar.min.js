/*!
 * MiniBar 0.0.1
 * http://mobius.ovh/
 *
 * Released under the MIT license
 */
!function(t){"use strict";function e(t,e,o){if("[object Object]"===Object.prototype.toString.call(t))for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(o,i,t[i]);else for(var n=0,s=t.length;n<s;n++)e.call(o,n,t[n])}function o(t,e,o){t.addEventListener(e,o,!1)}function i(t,e,o){t.removeEventListener(e,o)}function n(t,o,i){var n=t&&t.style,s="[object Object]"===Object.prototype.toString.call(o);if(n){if(void 0===i&&!s)return i=window.getComputedStyle(t),void 0===o?i:i[o];s?e(o,function(t,e){t in n||(t="-webkit-"+t),n[t]=e+("string"==typeof e?"":"opacity"===t?"":"px")}):(o in n||(o="-webkit-"+o),n[o]=i+("string"==typeof i?"":"opacity"===o?"":"px"))}}function s(t){return t+.5<<0}function r(t){return~~t}function c(t){var e=window,o=document,i=o.body,n=t.getBoundingClientRect(),r=void 0!==e.pageXOffset?e.pageXOffset:(o.documentElement||i.parentNode||i).scrollLeft,c=void 0!==e.pageYOffset?e.pageYOffset:(o.documentElement||i.parentNode||i).scrollTop;return{x:n.left+r,y:n.top+c,height:s(n.height),width:s(n.width)}}function h(t,e,o){var i=void 0;return function(){var n=this,s=arguments,r=function(){i=null,o||t.apply(n,s)},c=o&&!i;clearTimeout(i),i=setTimeout(r,e),c&&t.apply(n,s)}}function l(){var t=0,e=document.createElement("div");return e.style.cssText="width: 100; height: 100; overflow: scroll; position: absolute; top: -9999;",document.body.appendChild(e),t=e.offsetWidth-e.clientWidth,document.body.removeChild(e),t}var a={minBarSize:50},d=window.requestAnimationFrame||function(){var t=0;return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){var o=(new Date).getTime(),i=void 0;return i=Math.max(0,16-(o-t)),t=o+i,setTimeout(function(){e(o+i)},i)}}(),u=function(t,e){this.content=t,"string"==typeof t&&(this.content=document.querySelector(t)),this.config=this.extend({},a,e),this.css=window.getComputedStyle(this.content),this.scrollbarSize=l(),this.events={update:this.update.bind(this),scroll:this.scroll.bind(this),mouseenter:this.mouseenter.bind(this),mousedown:this.mousedown.bind(this),mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)},this.events.debounce=h(this.events.update,50),this.init()};u.prototype.init=function(){var t=this;this.content.classList.add("mb-content"),this.container=document.createElement("div"),this.container.classList.add("mb-container"),this.bars={x:{node:document.createElement("div")},y:{node:document.createElement("div")}},this.tracks={x:{node:document.createElement("div")},y:{node:document.createElement("div")}},e(this.tracks,function(e,i){i.node.classList.add("mb-track","mb-track-"+e),t.bars[e].node.classList.add("mb-bar"),i.node.appendChild(t.bars[e].node),t.container.appendChild(i.node),o(t.bars[e].node,"mousedown",t.events.mousedown)}),this.content.parentNode.insertBefore(this.container,this.content),this.container.appendChild(this.content),this.container.style.position="static"===this.css.position?"relative":this.css.position,this.update(),o(this.content,"scroll",this.events.scroll),o(this.container,"mouseenter",this.events.mouseenter),o(window,"resize",this.events.debounce)},u.prototype.scroll=function(){this.updateScrollBar("x"),this.updateScrollBar("y")},u.prototype.mouseenter=function(){this.updateScrollBar("x"),this.updateScrollBar("y")},u.prototype.mousedown=function(t){t.preventDefault();var e=t.target===this.bars.x.node?"x":"y",i=this.bars[e],n=this.tracks[e];this.currentAxis=e,this.update(),this.origin={x:t.pageX-i.x,y:t.pageY-i.y,axis:"page"+e.toUpperCase(),prop:"x"===e?n.width:n.height,size:"x"===e?"scrollWidth":"scrollHeight",offset:"x"===e?"scrollLeft":"scrollTop"},o(document,"mousemove",this.events.mousemove),o(document,"mouseup",this.events.mouseup)},u.prototype.mousemove=function(t){t.preventDefault();var e=this.origin,o=this.currentAxis,i=t[e.axis],n=this.tracks[o],s=this.content,r=(i-e[o]-n[o])/e.prop*this[e.size];d(function(){s[e.offset]=r})},u.prototype.mouseup=function(){this.origin={},this.currentAxis=null,i(document,"mousemove",this.events.mousemove),i(document,"mouseup",this.events.mouseup)},u.prototype.update=function(){var t=this;e(this.tracks,function(e,o){t.extend(o,c(o.node)),t.extend(t.bars[e],c(t.bars[e].node))}),this.rect=c(this.container),this.scrollTop=this.content.scrollTop,this.scrollLeft=this.content.scrollLeft,this.scrollHeight=this.content.scrollHeight,this.scrollWidth=this.content.scrollWidth;var o=this.scrollWidth>this.rect.width,i=this.scrollHeight>this.rect.height;this.container.classList.toggle("mb-scroll-x",o),this.container.classList.toggle("mb-scroll-y",i),n(this.content,{overflow:"auto",marginBottom:o?-this.scrollbarSize:"",paddingBottom:o?this.scrollbarSize:"",marginRight:i?-this.scrollbarSize:"",paddingRight:i?this.scrollbarSize:""}),this.scrollX=o,this.scrollY=i,this.updateScrollBar("x"),this.updateScrollBar("y")},u.prototype.updateScrollBar=function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?"y":arguments[0],o={},i="x"===e?"left":"top",s="x"===e?"width":"height",c="x"===e?"scrollLeft":"scrollTop",h="x"===e?"scrollWidth":"scrollHeight",l=(this.bars[e].node,this[h]),a=this.tracks[e][s],u=a/l,p=this.content[c]/(l-a);o[s]=Math.max(r(u*a),this.config.minBarSize),o[i]=r((a-o[s])*p),d(function(){n(t.bars[e].node,o)})},u.prototype.destroy=function(){var t=this;e(this.tracks,function(e,o){i(t.bars[e].node,"mousedown",t.events.mousedown)}),i(this.content,"scroll",this.events.scroll),i(this.container,"mouseenter",this.events.mouseenter),i(window,"resize",this.events.debounce),this.content.removeAttribute("style"),this.container.parentNode.replaceChild(this.content,this.container)},u.prototype.extend=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(t),i=1;i<arguments.length;i++){var n=arguments[i];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(o[s]=n[s])}return o},t.MiniBar=u}(this);